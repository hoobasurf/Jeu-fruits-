<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jeu Fruits Lilo & Stitch</title>
<style>
    body {
        margin: 0;
        padding: 0;
        background: url('fruits.jpg') no-repeat center center fixed;
        background-size: cover;
        font-family: Arial, sans-serif;
        color: white;
        user-select: none;
        touch-action: none;
    }
    #game {
    display: grid;
    grid-template-columns: repeat(5, 70px);
    grid-template-rows: repeat(5, 70px);
    gap: 2px; /* moins d’espace entre fruits */
    margin-top: 20px;
    touch-action: none;
}

.cell {
    width: 70px;
    height: 70px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible; /* pour que l’image plus grande dépasse */
}

.cell img {
    width: 90px;   /* plus grand que la cellule */
    height: 90px;
    object-fit: contain;
    pointer-events: none;
    user-select: none;
    transition: transform 0.1s ease, filter 0.1s ease;
}

.selected img {
    transform: scale(1.5); /* agrandissement encore plus fort au survol */
    filter: drop-shadow(0 0 10px yellow);
}
    #hud {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 20px;
        font-size: 20px;
        background: rgba(0,0,0,0.5);
        padding: 10px 20px;
        border-radius: 15px;
    }
    #endScreen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.8);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 40px;
        z-index: 10;
    }
    #endScreen button {
        font-size: 20px;
        margin: 10px;
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
    }
</style>
</head>
<body>

<div id="hud">
    <div id="objectives"></div>
    <div>Coups : <span id="moves">30</span></div>
</div>

<div id="game"></div>

<div id="endScreen">
    <div id="endMessage"></div>
    <div>
        <button onclick="startGame()">Recommencer</button>
        <button onclick="location.reload()">Quitter</button>
    </div>
</div>

<script>
const fruits = ["banane.png", "ananas.png", "fraise.png", "kiwi.png", "noix.png"];
let grid = [];
let selected = [];
let objectives = {};
let movesLeft = 30;
let selectingType = null;

function randomFruit() {
    return fruits[Math.floor(Math.random() * fruits.length)];
}

function startGame() {
    document.getElementById("endScreen").style.display = "none";
    movesLeft = 30;
    objectives = {};
    let chosen = [...fruits].sort(() => Math.random() - 0.5).slice(0, 3);
    chosen.forEach(f => objectives[f] = Math.floor(Math.random() * 6) + 5);
    renderObjectives();
    grid = Array.from({length: 6}, () => Array.from({length: 6}, randomFruit));
    drawGrid();
}

function renderObjectives() {
    document.getElementById("objectives").innerHTML = Object.entries(objectives)
        .map(([f,q]) => `<img src="${f}" style="width:25px;height:25px;vertical-align:middle;"> ${q}`)
        .join(" &nbsp; ");
}

function drawGrid() {
    const game = document.getElementById("game");
    game.innerHTML = "";
    grid.forEach((row,r) => {
        row.forEach((fruit,c) => {
            let cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.row = r;
            cell.dataset.col = c;
            cell.innerHTML = `<img src="${fruit}">`;
            game.appendChild(cell);
        });
    });
}

function getNeighbors(r, c) {
    return [
        [r-1, c], [r+1, c], [r, c-1], [r, c+1],
        [r-1, c-1], [r-1, c+1], [r+1, c-1], [r+1, c+1]
    ].filter(([rr,cc]) => rr>=0 && rr<6 && cc>=0 && cc<6);
}

function handleStart(e) {
    selected = [];
    selectingType = null;
    handleMove(e);
}
function handleMove(e) {
    let touch = e.touches ? e.touches[0] : e;
    let el = document.elementFromPoint(touch.clientX, touch.clientY);
    if (el && el.tagName === "IMG") el = el.parentElement;
    if (!el || !el.classList.contains("cell")) return;
    let r = +el.dataset.row, c = +el.dataset.col;
    if (!selected.some(s => s[0] === r && s[1] === c)) {
        let fruit = grid[r][c];
        if (!selectingType) selectingType = fruit;
        if (fruit === selectingType) {
            let last = selected[selected.length - 1];
            if (!last || getNeighbors(last[0], last[1]).some(([rr,cc]) => rr === r && cc === c)) {
                selected.push([r,c]);
                el.classList.add("selected");
            }
        }
    }
}
function handleEnd() {
    if (selected.length > 0) {
        movesLeft--;
        document.getElementById("moves").textContent = movesLeft;
        let type = selectingType;
        selected.forEach(([r,c]) => { grid[r][c] = null; });
        Object.keys(objectives).forEach(f => {
            if (f === type) objectives[f] = Math.max(0, objectives[f] - selected.length);
        });
        dropFruits();
        renderObjectives();
        checkEnd();
    }
    document.querySelectorAll(".selected").forEach(e => e.classList.remove("selected"));
    selected = [];
    selectingType = null;
}

function dropFruits() {
    for (let c = 0; c < 6; c++) {
        let col = grid.map(row => row[c]).filter(x => x !== null);
        while (col.length < 6) col.unshift(randomFruit());
        for (let r = 0; r < 6; r++) grid[r][c] = col[r];
    }
    drawGrid();
}

function checkEnd() {
    if (Object.values(objectives).every(v => v === 0)) {
        endGame("GAGNÉ !");
    } else if (movesLeft <= 0) {
        endGame("PERDU !");
    }
}

function endGame(msg) {
    document.getElementById("endMessage").textContent = msg;
    document.getElementById("endScreen").style.display = "flex";
}

document.addEventListener("mousedown", handleStart);
document.addEventListener("mousemove", handleMove);
document.addEventListener("mouseup", handleEnd);
document.addEventListener("touchstart", handleStart);
document.addEventListener("touchmove", handleMove);
document.addEventListener("touchend", handleEnd);

startGame();
</script>
</body>
</html>
